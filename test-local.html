<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalDB Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ—„ï¸ LocalDB Test</h1>
        
        <div class="bg-white rounded-lg shadow p-6 space-y-4">
            <button onclick="testLocalDB()" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                Test LocalDB
            </button>
            
            <button onclick="testImageUpload()" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                Test FotoÄŸraf YÃ¼kleme
            </button>
            
            <button onclick="showStats()" class="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                Ä°statistikleri GÃ¶ster
            </button>
            
            <button onclick="clearData()" class="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700">
                TÃ¼m Verileri Sil
            </button>
            
            <div id="output" class="mt-6 p-4 bg-gray-100 rounded-lg font-mono text-sm whitespace-pre-wrap"></div>
        </div>
    </div>

    <script src="local-database.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.textContent += message + '\n';
            console.log(message);
        }
        
        function testLocalDB() {
            output.textContent = '';
            log('ğŸ§ª LocalDB Test BaÅŸlÄ±yor...\n');
            
            try {
                // VeritabanÄ±nÄ± baÅŸlat
                log('1. VeritabanÄ± baÅŸlatÄ±lÄ±yor...');
                LocalDB.initialize();
                log('âœ… VeritabanÄ± baÅŸlatÄ±ldÄ±\n');
                
                // MenÃ¼ verilerini al
                log('2. MenÃ¼ verileri alÄ±nÄ±yor...');
                const menu = LocalDB.menu.getAll();
                log(`âœ… ${menu.length} Ã¼rÃ¼n bulundu\n`);
                
                // Kategorileri al
                log('3. Kategoriler alÄ±nÄ±yor...');
                const categories = LocalDB.categories.getAll();
                log(`âœ… ${categories.length} kategori bulundu\n`);
                
                // AyarlarÄ± al
                log('4. Ayarlar alÄ±nÄ±yor...');
                const settings = LocalDB.settings.get();
                log(`âœ… Cafe: ${settings.cafeName}\n`);
                
                // Test Ã¼rÃ¼nÃ¼ ekle
                log('5. Test Ã¼rÃ¼nÃ¼ ekleniyor...');
                const testProduct = {
                    id: Date.now(),
                    name: 'Test ÃœrÃ¼nÃ¼',
                    category: 'sicak',
                    price: '50â‚º',
                    image: '',
                    description: 'Test iÃ§in eklenen Ã¼rÃ¼n',
                    details: {}
                };
                LocalDB.menu.save(testProduct);
                log('âœ… Test Ã¼rÃ¼nÃ¼ eklendi\n');
                
                // Depolama istatistikleri
                log('6. Depolama istatistikleri...');
                const stats = LocalDB.stats.getStorageUsage();
                log(`âœ… KullanÄ±lan: ${stats.used} MB / ${stats.max} MB (%${stats.percentage})\n`);
                
                log('ğŸ‰ TÃœM TESTLER BAÅARILI!');
                
            } catch (error) {
                log(`âŒ HATA: ${error.message}`);
                console.error(error);
            }
        }
        
        function testImageUpload() {
            output.textContent = '';
            log('ğŸ“¸ FotoÄŸraf YÃ¼kleme Testi\n');
            log('LÃ¼tfen bir fotoÄŸraf seÃ§in...\n');
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    log(`Dosya: ${file.name}`);
                    log(`Boyut: ${(file.size / 1024).toFixed(2)} KB\n`);
                    
                    log('Base64\'e Ã§evriliyor...');
                    const base64 = await LocalDB.image.toBase64(file);
                    log(`âœ… Base64 boyutu: ${(base64.length / 1024).toFixed(2)} KB\n`);
                    
                    log('Optimize ediliyor...');
                    const optimized = await LocalDB.image.optimize(base64, 800, 600, 0.8);
                    log(`âœ… Optimize boyutu: ${(optimized.length / 1024).toFixed(2)} KB\n`);
                    
                    log('ğŸ‰ FotoÄŸraf baÅŸarÄ±yla iÅŸlendi!');
                    
                } catch (error) {
                    log(`âŒ HATA: ${error.message}`);
                }
            };
            
            input.click();
        }
        
        function showStats() {
            output.textContent = '';
            log('ğŸ“Š Ä°statistikler\n');
            
            try {
                const storageStats = LocalDB.stats.getStorageUsage();
                const productStats = LocalDB.stats.getProductStats();
                
                log('=== DEPOLAMA ===');
                log(`KullanÄ±lan: ${storageStats.used} MB`);
                log(`Toplam: ${storageStats.max} MB`);
                log(`YÃ¼zde: %${storageStats.percentage}`);
                log(`BoÅŸ: ${storageStats.available} MB\n`);
                
                log('=== ÃœRÃœNLER ===');
                log(`Toplam: ${productStats.totalProducts}`);
                log(`FotoÄŸraflÄ±: ${productStats.withImages}`);
                log(`FotoÄŸrafsÄ±z: ${productStats.withoutImages}\n`);
                
                log('=== KATEGORÄ°LER ===');
                for (const [category, count] of Object.entries(productStats.byCategory)) {
                    log(`${category}: ${count} Ã¼rÃ¼n`);
                }
                
            } catch (error) {
                log(`âŒ HATA: ${error.message}`);
            }
        }
        
        function clearData() {
            if (confirm('âš ï¸ TÃœM VERÄ°LER SÄ°LÄ°NECEK! Emin misiniz?')) {
                output.textContent = '';
                log('ğŸ—‘ï¸ Veriler siliniyor...\n');
                
                try {
                    LocalDB.clearAll();
                    log('âœ… TÃ¼m veriler silindi!');
                    log('Sayfa yenileniyor...');
                    setTimeout(() => location.reload(), 1500);
                } catch (error) {
                    log(`âŒ HATA: ${error.message}`);
                }
            }
        }
        
        // Sayfa yÃ¼klendiÄŸinde otomatik test
        window.addEventListener('load', () => {
            log('âœ… Sayfa yÃ¼klendi');
            log('LocalDB hazÄ±r: ' + (typeof LocalDB !== 'undefined' ? 'Evet' : 'HayÄ±r'));
            log('\nTest butonlarÄ±na tÄ±klayÄ±n...\n');
        });
    </script>
</body>
</html>
