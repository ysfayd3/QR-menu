<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase BaÄŸlantÄ± Testi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ”¥ Firebase BaÄŸlantÄ± Testi</h1>
        
        <div id="status" class="mb-6 p-4 rounded-lg bg-blue-50 border border-blue-200">
            <p class="text-blue-800">Test baÅŸlatÄ±lÄ±yor...</p>
        </div>
        
        <div id="results" class="space-y-4">
            <!-- Test sonuÃ§larÄ± buraya eklenecek -->
        </div>
        
        <div class="mt-6 flex gap-3">
            <button onclick="testConnection()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                ğŸ”„ Tekrar Test Et
            </button>
            <button onclick="initializeData()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium">
                ğŸ“¥ VarsayÄ±lan Verileri YÃ¼kle
            </button>
            <a href="index.html" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium text-center">
                ğŸ  MenÃ¼ye Git
            </a>
        </div>
    </div>

    <script>
        async function testConnection() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            statusDiv.innerHTML = '<p class="text-blue-800">â³ Firebase baÄŸlantÄ±sÄ± test ediliyor...</p>';
            
            try {
                // Test 1: Firebase baÄŸlantÄ±sÄ±
                addResult('âœ… Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±', 'success');
                addResult(`ğŸ“¦ Proje ID: ${firebase.app().options.projectId}`, 'info');
                
                // Test 2: Firestore baÄŸlantÄ±sÄ±
                const testDoc = await db.collection('_test').doc('connection').set({
                    timestamp: new Date(),
                    message: 'Test baÅŸarÄ±lÄ±'
                });
                addResult('âœ… Firestore yazma testi baÅŸarÄ±lÄ±', 'success');
                
                // Test 3: Veri okuma
                const menuData = await FirebaseDB.getMenu();
                addResult(`âœ… MenÃ¼ verileri okundu: ${menuData.length} Ã¼rÃ¼n`, 'success');
                
                const categories = await FirebaseDB.getCategories();
                addResult(`âœ… Kategoriler okundu: ${categories.length} kategori`, 'success');
                
                const settings = await FirebaseDB.getSettings();
                addResult(`âœ… Ayarlar okundu: ${settings ? settings.cafeName : 'Yok'}`, 'success');
                
                statusDiv.innerHTML = '<p class="text-green-800 font-bold">ğŸ‰ TÃ¼m testler baÅŸarÄ±lÄ±! Firebase baÄŸlantÄ±sÄ± Ã§alÄ±ÅŸÄ±yor.</p>';
                statusDiv.className = 'mb-6 p-4 rounded-lg bg-green-50 border border-green-200';
                
            } catch (error) {
                console.error('Test hatasÄ±:', error);
                addResult(`âŒ Hata: ${error.message}`, 'error');
                statusDiv.innerHTML = `<p class="text-red-800 font-bold">âŒ Test baÅŸarÄ±sÄ±z: ${error.message}</p>`;
                statusDiv.className = 'mb-6 p-4 rounded-lg bg-red-50 border border-red-200';
            }
        }
        
        async function initializeData() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<p class="text-blue-800">â³ VarsayÄ±lan veriler yÃ¼kleniyor...</p>';
            statusDiv.className = 'mb-6 p-4 rounded-lg bg-blue-50 border border-blue-200';
            
            try {
                // Mevcut veri kontrolÃ¼
                const existingMenu = await FirebaseDB.getMenu();
                if (existingMenu && existingMenu.length > 0) {
                    if (!confirm(`Firebase'de zaten ${existingMenu.length} Ã¼rÃ¼n var. Ãœzerine yazmak istediÄŸinizden emin misiniz?`)) {
                        statusDiv.innerHTML = '<p class="text-gray-800">Ä°ÅŸlem iptal edildi.</p>';
                        statusDiv.className = 'mb-6 p-4 rounded-lg bg-gray-50 border border-gray-200';
                        return;
                    }
                }
                
                // Admin panelindeki varsayÄ±lan verileri kullan
                // Bu kÄ±sÄ±m admin-modern.js'deki initializeDefaultData fonksiyonunu Ã§aÄŸÄ±rÄ±r
                statusDiv.innerHTML = '<p class="text-orange-800">âš ï¸ VarsayÄ±lan verileri yÃ¼klemek iÃ§in admin paneline gidin ve ilk kez giriÅŸ yapÄ±n.</p>';
                statusDiv.className = 'mb-6 p-4 rounded-lg bg-orange-50 border border-orange-200';
                
                addResult('â„¹ï¸ Admin paneline giriÅŸ yaparak varsayÄ±lan veriler otomatik yÃ¼klenecek', 'info');
                
            } catch (error) {
                console.error('Veri yÃ¼kleme hatasÄ±:', error);
                statusDiv.innerHTML = `<p class="text-red-800 font-bold">âŒ Hata: ${error.message}</p>`;
                statusDiv.className = 'mb-6 p-4 rounded-lg bg-red-50 border border-red-200';
            }
        }
        
        function addResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const colors = {
                success: 'bg-green-50 border-green-200 text-green-800',
                error: 'bg-red-50 border-red-200 text-red-800',
                info: 'bg-blue-50 border-blue-200 text-blue-800'
            };
            
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg border ${colors[type]}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }
        
        // Sayfa yÃ¼klendiÄŸinde otomatik test
        window.addEventListener('load', testConnection);
    </script>
</body>
</html>
